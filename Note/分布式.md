# 分布式

分布式 若干独立计算机的集合，这些计算机对于用户来说就像单个系统

硬件独立，软件同一

分布计算结构 将原来系统内中央处理器处理任务分配交给相应处理器

设计分布式系统  合理地将一个系统拆分成多个子系统并部署到不同的机器上

问题 

如何将系统拆分为子系统

如何规划子系统间的通信0

如何考虑通信过程中的安全性

如何让子系统可以扩展

如何保证子系统的可靠性

如何实现数据的一致性

纤程 Fiber

以用户方式代码来实现的，并不受操作系统内核管理，纤程是根据用户定义的算法来进行调度，纤程采用了非抢占式调度方式。

simplethreads



UNIX I/O模型

阻塞I/O

进程死锁循环等待返回数据

非阻塞I/O

进程循环发生信号调用返回数据，当数据准备完毕时相应信号返回，否则返回错误信息

I/O复用

select和poll函数的使用 让用户可以在

信号驱动I/O

信号驱动SIGIO 进程提出请求后继续运行 当内核返回完成信号后激活进程处理数据

异步I/O

当数据处理完成时调用激活进程

远程过程调用 RPC

进程间通信IPC

过程调用类型 

本进程调用

本主机调用

不同主机间调用





# 数据 

需求： 

数据量的增加，机器学习的需求

![](D:\Learn\NewSQL.jpg)

分布式：

容量可扩展

存储分类：
本地
网络：网络文件，共享文件系统：nfs，hdfs，glusterfs	共享裸设备存储：块存储：cinder，ceph	SAN
分布式：集群
三层，client namenode（元数据（数据系统描述）服务器） datanode（初始数据存放）：

Hadoop HDFS（大数据分布式文件系统）
高容错性：数据自动保存多个副本，副本丢失，自动恢复 
良好数据访问机制：一次写入、多次读取，保证数据一致性 
适合大数据文件的存储：大量数据存储，扩展能力强

高低延迟数据访问：无法在ms下需求应用
海量小数据存取冗余：占用namenode
一个文件只有一个写入：仅支持append

OpenStack 对象存储Swift
存储节点对等，对称的系统架构
开发者通过一个RESTful HTTP API 与对象存储系统相互作用
无单点故障：Swift元数据存储均匀随机分布，且与对象文件存储一样，元数据也有副本，整个集群无一为单点
可在不影响性能的情况下，集群通过增加外部节点进行扩展
无限的可扩展性：容量，性能
极高的数据持久性

公有云
云服务

GlusterFS分布式文件系统 

GPFS和HDFS区别：
HDFS将文件分割成块，存储到不同文件系统节点中
HDFS对磁盘的可靠性依赖不搞，可在不同节点内存储块的副本。
GPFS支持故障节点恢复，但是是一个严重事件，具有数据丢失风险
GPFS支持完整Posix文件系统语义 HDF不支持
GPFS跨文件系统分布目录和其他元数据，Hadoop将其保留在主要和次要namenode中
GPFS将文件分割成小块，Hadoop在分割块是降低了namenode的存储需求，导致冗余

## Ceph

统一的分布式存储系统，提供较好的性能，可靠性和可扩展性

优势：
高扩展性：使用普通X86服务器，支持10~1000服务器集合，支持TB到EB级的扩展
高可靠性：没有单点故障，多数据副本，自动管理，自动修复
高性能：数据分布均衡
可用于对象存储，块设备存储，文件系统存储

架构:
![](D:\Learn\Ceph架构.png)

1. rados（可靠，自动化，分布式，对象存储）:基础存储系统：真正的数据存储服务提供，ceph的优势和本质由此提供
2. librados 基础库：对rados的抽象和封装，向上提供API（只针对对象存储功能）
3. 高层应用接口radosgw（对象网关接口（对象存储）），rbd（块存储），cephfs（文件系统存储）：在librados基础上提供抽象层次更高的上层接口

## Ceph基本组件：

![](D:\Learn\CEPH组件.png)

Osd：集群中数据与对象的存储，处理集群数据的复制，恢复，回填，在均衡。并向其他osd守护进程发送心跳，然后向Mon提供一些监控信息

MDS：为Ceph文件系统提供元数据计算、缓存与同步

Mon（Monitot）：监控整个集群的状态，维护集群的clusterMao二进制表，保证集群数据的一致性。

Manager：用于收集ceph集群状态、运行指标。

## Ceph存储种类与应用场景：

### 块存储：磁盘阵列 主要是将裸盘空间映射给主机使用

优点：通过Radi和LVM对数据提供保护，多块廉价硬盘组合提高容量，提升读写效率

缺点：采用SAN架构组网时，光纤交换机，造价高，主机之间无法共享数据

场景：Docker容器 虚拟机磁盘存储分配，日志存储，文件存储

### 文件存储：FTP,NFS

优点：造价低，方便文件共享

缺点：读写效率低，传输慢

场景：日志存储，有目录结构的文件存储

### 对象存储

数据访问先访问元数据服务器，再访问数据存储的分布式服务器

通过多台osd（分布服务器）的传输实现读写速度快

优点：具备块存储的读写高速，具备文件存储的共享

场景：变动较少的数据

Ceph同时提供对象存储，块存储，文件系统存储三种功能

## Ceph存储过程

![](D:\Learn\ceph存储过程.png)

![](D:\Learn\ceph存储2.png)

名词：

![](D:\Learn\ceph名词1.png)

![](D:\Learn\ceph名词2.png)