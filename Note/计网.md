# 计网

因特网:互联全世界的计算机网络

网络终端:主机/端系统 通过通信链路和分组交换机连接的终端设备

通信链路:由物理载体形成的网络通路

分组:发送数据时发送端将数据分段并为每段加上首部字节

分组交换机:将分组从一条通信链路接收并从另一条通信链路发送

输入端使用存储转发传输机制(向输出链路传输分组前需接收到整个分组)

输出缓存/输出队列:分组到达交换机时交换机未完成上个分组的发送工作将接受分组放入输出缓存中 分组等待时间为排队时延 当缓存饱满时新分组到达交换机将所有到达分组中一部分丢弃导致丢包

> 两种类型:路由器,链路层交换机(链路交换机用于接入网中,路由器用于网络核心中)\

转发表:在分组交换机选择输出路径时将目的地址映射成输出链路

路由选择协议:决定路由器到每个目的地的最短路径并使用此结果配置转发表

路径:一个分组经历的一系列通信链路与分组交换机

ISP:Internet Service Provider 因特网服务提供商(端系统通过此接入Internet) 由一个或多个分组交换机和多段通信链路组成的网络,ISP间互联.

分布式应用程序:涉及多台相互交换数据的端系统的程序 数据交换过程中不关心数据源或宿的应用程序

API:Application Programming Interface 应用程序编程接口 

因特网API:规定了运行在一个端系统上的软件请求因特网基础设施向运行在另一个端系统上的特定目的软件交换数据的方式.

协议:一个协议定义了在两个或多个通信实体间交换的报文格式和次序,以及报文发送和接收或其他事件时采取的动作.

DSL:Digital Subscribe Line 数字用户线 住户通过本地电话公司获得DSL接入互联网

电话线传输频率划分:0-4khz 普通双向电话通道

​				    4khz-50khz 中速上行通道

​				    50khz-1Mhz 高速下行通道

电缆英特网接入:用户通过电缆调制解调器试数据从一个以太网端口由电缆传输数据到光纤结点 然后由光纤传到电缆头端的电缆调制解调器端接系统 Cable Modem Termination System (CMTS)将模拟信号转数字信号接入Internet

光纤到户 Filber To The Home FTTH:直接用光钎连接地方中心局和用户

以太网连接:用户连接到以太网交换机,再连接到机构的路由器连接机构ISP

物理媒体:导引型媒体(电波通过固体媒体传播)/非导引型媒体(电波通过空气或场传播)

> 双铜绞线,同轴电缆,光纤,陆地无线电信通,卫星无线电信通

数据传递:电路交换(预留网路资源),分组交换(实时分配网路资源)

电路交换的复用:频分复用(将赔率分割预配资源),时分复用(将帧分割预配资源)

ISP互联:接入ISP连接到区域ISP,同级区域ISP互联,区域ISP连接上层区域ISP,最高级区域ISP连接全球型ISP,第一层ISP互联.

PoP:存在点 Point of Presence ISP网络中的路由器群组

多宿:与多个提供商ISP连接

对等:同级ISP间相邻相连

时延主要分成:排队时延,结点处理时延,传输时延,传播时延.

处理时延:检查分组首部并决定该分组导向何处以及检查比特级别的差错等所需时间

排队时延:分组在输出缓存中的等待时间

传输时延:将分组所有比特推向链路的时间(与分组长度和链路传输有关)

传播时延:分组在链路中传播的时间(与路由器间距离有关)

流量强度:设a为分组到达平均速率 R为传输速率L为分组比特大小 La/R为流量强度

流量强度不能大于一 (否则排队时延趋向无限大)

端到端时延:设源主机到目的主机间有N条链路,则时延为N(处理时延+传输时延+传播时延)

吞吐量:min{链路输出速率,链路输入速率}

分层协议体系:上层工作后,上层协议要求下层工作,下层工作基于上层的工作结果.

协议栈:各层所有协议

自顶向下处理:从第一层协议开始处理一步一步向下层进行

应用层:

> 协议:HTTP,SMTP,FTP
>
>  信息分组:报文

运输层:

> 协议:TCP(面向连接服务),UDP(无连接服务)
>
> 信息分组:报文段

网络层:

> 信息分组:数据报
>
> 协议:IP协议,路由选择协议等

链路层:

> 信息分组:帧

物理层:



OSI模型:比因特网协议栈在应用层下多表示层和会话层

封装:本层将上一层信息分组(有效载荷字段)附上本层首部信息(首部字段)并传递再给下一层



## 应用层

1. 网络应用程序体系结构:

   规定如何在各种端系统上组织该应用程序

   1. 客户-服务器体系结构:客户通过连接向服务器发送请求,服务器在收到请求后返回报文.客户间不能直接通信,服务器拥有固定,周知的IP地址

   2. P2P(对等)体系结构:通过服务器间接连接的主机间直接通信

      > 自扩展性:每个请求方在产生工作量的同时向其他对等用户发送文件也为系统增加服务能力

2. 进程通信

   系统通过进程进行通信

   客户服务器系统中 发起通信的一方为客户另一方为服务器

   进程通过套接字向网络发送和接收报文

   套接字为一台主机内应用层和运输层间的接口 若套接字为建立网络应用程序的可编程接口 也可称为应用程序与网络间的应用程序编程接口

   发送报文需表明目的地主机IP和接收嵌套字

   开发网络程序时必须选择一种可用的运输层协议

3. 可靠数据传输(TCP协议)

4. 可用吞吐量 发送进程能向接收进程交付比特的速率

   带宽敏感应用对吞吐量有要求

   弹性应用可根据实际情况利用吞吐量

### TCP服务

​	面向连接和可靠数据传输服务

​	面向连接:在连接开始之前先进行一次握手,握手之后建立两者套接字之间的TCP的连接

​	可靠数据服务:依靠TCP连接无差错 按适当顺序交付所有数据

​	拥有拥塞控制机制

​	安全:安全套接字层(secure sockets layer SSL)

### UDP服务

​	不提供不必要服务的轻量级运输协议 无连接型 不存在一次握手 提供不可靠数据传输服务 不保证数据是否到达与到达的顺序

​	

### 应用层协议

​	定义运行在端系统上的应用程序进程如何相互传递报文

​	定义:交换报文类型 各种报文的语法  字段包含信息含义 进程何时如何发送报文以及报文进行相应的规则

### HTTP 超文本传输协议(HyperText Transfer Protocol)

​	web的应用层协议(在RFC1945和RFC2616中进行了定义)

​	



#### web页面由对象组成 (一个HTML基本文件以及多个引用对象组成)HTML文本通过对象的URL的地址引用页面其他对象  URl地址由两部分组成 存放对象的服务器主机名和对象的路径名



**HTTP定义了web客户端向服务器请求页面的方式和服务器传送页面的方式**

> 以TCP作为支撑运输协议

先向服务器发送一个TCP连接请求在建立TCP连接后客户端浏览器和服务器进程通过套接字接口访问TCP连接

服务器向客户发送请求答复文件而不储存关于客户的状态信息，既HTTP为一个无状态协议

非持续连接：客户与服务器的请求报文和响应报文都通过一个单独的TCP连接传输

持续连接：客户与服务器的请求报文和响应报文通过一个总TCP连接传输

往返时间（Round-trip Time RTT）：指一个短分组从客户到服务器然后再返回客户的时间

### HTTP报文格式

##### 请求报文：![](C:\Users\79931\Pictures\wKioL1THNfahGAkDAAFu--59S3M173.jpg)



第一行：请求行 （3个字段 方法字段，URL字段，HTTP版本字段）

> 方法字段值： GET,POST,HEAD,PUT,DELETE 之间用空格隔开
>
> ● GET：当客户端要从服务器中读取某个资源时，使用GET 方法。GET 方法要求服务器将URL 定位的资源放在响应报文的[数据](http://ad.doubleclick.net/ddm/trackclk/N7442.5006CHINABYTE/B10313247.138166523;dc_trk_aid=310538354;dc_trk_cid=74205219)部分，回[送给](http://www.chinabyte.com/keyword/送给/)客户端，即向服务器请求某个资源。使用GET 方法时，请求参数和对应的值附加在 URL 后面，利用一个问号(“?”)代表URL 的结尾与请求参数的开始，传递参数长度受限制。例如，/index.jsp?id=100&op=bind。
>
> 对于缓存服务器而言为保证缓存服务器中的对象为最新版本 在GET方法中添加首部行：“If—Modified —Since向初始服务器确定对象为最新 若最新则从缓存服务器发送对象否则从原始服务器接受最新对象后再发送
>
> 
>
> ● POST：当客户端给服务器提供信息较多时可以使用POST 方法，POST 方法向服务器提交数据，比如完成表单数据的提交，将数据提交给服务器处理。GET 一般用于获取/查询资源信息，POST 会附带用户数据，一般用于更新资源信息。POST 方法将请求参数[封装](http://www.chinabyte.com/keyword/封装/)在HTTP 请求数据中，以名称/值的形式出现，可以传输大量数据;
>
> ● HEAD：服务器使用HEAD方法请求时，将会以一个HTTP报文进行响应但不返回请求对象（常用于调试追踪）
>
> ● PUT：常与web发行工具联合使用，允许用户上传对象到指定web服务器上的指定路径
>
> ● DELETE：允许用户或应用程序删除web服务器上的对象

后续行：首部行（请求头部）

请求头部由关键字/值对组成，每行一对，关键字和值用英文冒号“:”分隔。请求头部通知服务器有关于客户端请求的信息

>　● User-Agent：产生请求的[浏览器](http://www.chinabyte.com/keyword/浏览器/)类型;
>
> 
>
>　● Accept：客户端可识别的响应内容类型列表;星号 “ * ” 用于按范围将类型分组，用 “ */* ” 指示可接受全部类型，用“ type/* ”指示可接受 type 类型的所有子类型;
>
> 
>
>　● Accept-Language：客户端可接受的自然语言;
>
> 
>
>　● Accept-Encoding：客户端可接受的编码压缩格式;
>
> 
>
>　● Accept-Charset：可接受的应答的字符集;
>
> 
>
>　● Host：请求的主机名，允许多个[域名](http://www.chinabyte.com/keyword/域名/)同处一个IP 地址，即虚拟主机;
>
> 
>
>　● connection：连接方式(close 或 keepalive);
>
> 
>
>　● Cookie：[存储](http://storage.chinabyte.com/)于客户端扩展字段，向同一域名的服务端发送属于该域的cookie;
>
>

空行：代表请求头部的结束

实体主体：post方法时需要提交表单 将表单等内容存储在实体主体内



#### HTTP响应报文：![](C:\Users\79931\Pictures\20150126110634828.png)



三部分：状态行，首部行（响应头部），实体行（响应包体）

状态行： 3个字段：协议版本字段，状态码，相应状态信息

>● 状态码由三位数字组成，第一位数字表示响应的类型，常用的状态码有五大类如下所示：
>
> 　　1xx：表示服务器已接收了客户端请求，客户端可继续发送请求;
>
> 　　2xx：表示服务器已成功接收到请求并进行处理;
>
> 　　3xx：表示服务器要求客户端重定向;
>
> 　　4xx：表示客户端的请求有非法内容;
>
> 　　5xx：表示服务器未能正常处理客户端的请求而出现意外错误;
>
>● 状态码描述文本有如下取值：
>
> 　　200 OK：表示客户端请求成功;
>
> 　　400 Bad Request：表示客户端请求有语法错误，不能被服务器所理解;
>
> 　　401 Unauthonzed：表示请求未经授权，该状态代码必须与 WWW-Authenticate 报头域一起使用;
>
> 　　403 Forbidden：表示服务器收到请求，但是拒绝提供服务，通常会在响应正文中给出不提供服务的原因;
>
> 　　404 Not Found：请求的资源不存在，例如，输入了错误的URL;
>
> 　　500 Internal Server Error：表示服务器发生不可预期的错误，导致无法完成客户端的请求;
>
> 　　503 Service Unavailable：表示服务器当前不能够处理客户端的请求，在一段时间之后，服务器可能会恢复正常;

首部行：与请求报文的格式相同

> ●Location：Location响应报头域用于重定向接受者到一个新的位置。例如：客户端所请求的页面已不存在原先的位置，为了让客户端重定向到这个页面新的位置，服务器端可以发回Location响应报头后使用重定向语句，让客户端去访问新的域名所对应的服务器上的资源;
>
> ●Server：Server 响应报头域包含了服务器用来处理请求的软件信息及其版本。它和 User-Agent 请求报头域是相对应的，前者发送服务器端软件的信息，后者发送客户端软件(浏览器)和[操作系统](http://soft.chinabyte.com/os/)的信息。
>
> ●Vary：指示不可缓存的请求头列表;
>
> ●Connection：连接方式;
>
> 　　对于请求来说：close(告诉[ WEB 服务器](http://www.chinabyte.com/keyword/web服务器/)或者[代理服务器](http://www.chinabyte.com/keyword/代理服务器/)，在完成本次请求的响应后，断开连接，不等待本次连接的后续请求了)。keepalive(告诉WEB服务器或者代理服务器，在完成本次请求的响应后，保持连接，等待本次连接的后续请求);
>
> 　　对于响应来说：close(连接已经关闭); keepalive(连接保持着，在等待本次连接的后续请求); Keep-Alive：如果浏览器请求保持连接，则该头部表明希望WEB 服务器保持连接多长时间(秒);例如：Keep-Alive：300;
>
> ●WWW-Authenticate：WWW-Authenticate响应报头域必须被包含在401 (未授权的)响应消息中，这个报头域和前面讲到的Authorization 请求报头域是相关的，当客户端收到 401 响应消息，就要决定是否请求服务器对其进行验证。如果要求服务器对其进行验证，就可以发送一个包含了Authorization 报头域的请求;

空行：标志首部行的结束

实体行：响应报文的主要部分 ，包含所请求对象本身



#### cookie ：用户与服务器的交互

将内容与用户联系起来 使web网页能识别用户

4个组件：

HTTP响应报文中的一个cookie首部行，HTTP请求报文中的一个cookie首部行，用户端系统保留一个cookie，位于web站点的一个后端数据库

工作原理：

> 1、创建Cookie

> 当用户第一次浏览某个使用Cookie的网站时，该网站的服务器就进行如下工作： 

> ①该用户生成一个唯一的识别码（Cookie id），创建一个Cookie对象； 

> ②默认情况下它是一个会话级别的cookie，存储在浏览器的内存中，用户退出浏览器之后被删除。如果网站希望浏览器将该Cookie存储在磁盘上，则需要设置最大时效（maxAge），并给出一个以秒为单位的时间（将最大时效设为0则是命令浏览器删除该Cookie）； 

> ③将Cookie放入到HTTP响应报头，将Cookie插入到一个 Set-Cookie HTTP请求报头中。 

> ④发送该HTTP响应报文。 

> 2、设置存储Cookie 

> 浏览器收到该响应报文之后，根据报文头里的Set-Cookied特殊的指示，生成相应的Cookie，保存在客户端。该Cookie里面记录着用户当前的信息。 

> 3、发送Cookie 

> 当用户再次访问该网站时，浏览器首先检查所有存储的Cookies，如果某个存在该网站的Cookie（即该Cookie所声明的作用范围大于等于将要请求的资源），则把该cookie附在请求资源的HTTP请求头上发送给服务器。 

> 4、读取Cookie

>  服务器接收到用户的HTTP请求报文之后，从报文头获取到该用户的Cookie，从里面找到所需要的东西。



#### web缓存器 （代理服务器）

代表初始服务器对请求进行响应 （保存最近请求对象的副本）当再次请求为变化对象时直接由代理服务器直接返回对象

可大大减少对客户端请求的响应时间

可大大减少一个机构的接入链路到英特网的通信量

>
>
>



内容分发网络（Content Distribution Network CDN）



#### 文件传输协议：FTP

通过两并行的TCP连接进行数据传输，一个为控制连接 一个为数据连接

> 控制连接传输两个端之间的控制信息（带外传输） //HTTP为一个TCP连接传输数据与命令（带内传输）
>
> 数据连接用于实现数据传输

用户主机开始会话时 用户主机先在21号端口与服务器发送一个控制TCP连接 后发送连接命令

 在传输对象时在20端口打开一个数据TCP连接 

> 控制连接贯穿整个FTP服务 但数据连接每进行一次数据传输就要打开一个新的数据连接 且FTP服务必须在整个对话期间保持用户状态而 HTTP服务是无状态的

FTP服务的命令与回答都是通过7比特的ASCII格式在控制连接上发送的

> 命令：
>
> USER username：用于向服务器传送用户表识
>
> PASS password： 用于向服务器发送用户口令
>
> LIST：用于请求服务器回送当前远程目录里的所有文件列表（列表由数据连接发送）
>
> RETE filename：用于从远程主机当前目录get文件
>
> STOR filename：用于向远程主机当前目录下存放文件
>
> 回答：（与命令一一对应）
>
> 331 Username OK，Password required
>
> 125 Data connection already open；transfer starting
>
> 425 Can't open data connection
>
> 452 Error writing file （写文件错误）

#### 简单邮件传输协议（SMTP）：

邮件服务系统：用户代理，邮件服务器，简单邮件传输协议 三者组成

传输过程：由发送方的用户代理到发送方的邮件服务器到接收方的邮件服务器到接收方的邮箱 若发送方服务器无法发送给接收方服务器则报文进入报文队列中并保持发送该报文每30分钟进行一次尝试 若几天后仍无法发送则删除报文并响应给发送方

SMTP在25号端口上基于TCP连接传输 用于发送方服务器发送报文给接收方服务器 且不经过中间服务器直接发送

发送数据前先进行一次握手 

HTTP为拉连接（向服务器索取数据） SMTP为推连接（向服务器发送数据） 且SMTP要求每个报文使用7比特的ASCII编码模式而HTTP不用



#### 邮件访问协议：

接收方代理通过邮件访问协议从接收方邮箱服务器接收邮件

#### POP3（第三版邮局协议 Post Office Protocol-Version3）

在110端口上工作

#### IMAP（因特网邮件访问协议 Internet Mail Access Protocol）

最新的IMAP4在143端口上工作



#### DNS因特网目录服务：

为匹配主机名与IP地址 建立了域名系统（Domain Name System）：一个由分层DNS服务器实现的分布式数据库 和 一个使主机能够查询到分布式数据库的应用层协议 （DNS协议运行在UDP上 使用53号端口）

DNS服务： 

主机名到IP名的转换

主机别名存在时将主机别名转换对应的规范主机名以及主机名的IP地址

邮件服务器别名存在时对其判别成对应规划主机名和IP地址

负载分配 繁忙的站点被冗余分布到多台服务器上

分布层次数据库：

根DNS服务器，顶级域服务器，权威服务器，本地DNS服务器（每个ISP的默认名字服务器）

递归查询：查询一个主机名的IP时主机的本地服务器先从根服务器得到主机所属的顶级域服务器IP再从顶级域服务器得到所属的权威服务器的IP再从权威服务器得到IP

迭代查询：主机向本地服务器提交查询请求 本地服务器向根服务器查询，根服务器向顶级域查询，顶级域向权威服务器查询 然后一次将IP返回

DNS缓存本地服务器收到一个DNS回答时将其缓存在有效期间重新收到相同请求时直接返回 绕开查询链

DNS服务器资源记录（RR Resource Record）提供了主机名到IP地址的映射 每个DNS报文中保存了一条或多条RR

> RR包含元组：（Name，Value，Type，TTL）
>
> Type = A Name为主机名，Value为对应IP
>
> Type = NS Name为域名，Value为对应权威主机名
>
> Type = CNAME Value对应别名为Name的规范主机名
>
> Type = MX Value 为 别名为Name 的邮件服务器规范主机名



DNS报文格式：![](C:\Users\79931\Pictures\20150425094515740.jpg)

> - 前12字节为首部区域
>
>   标识符，16比特的数用于标识该查询 该标识符会被复制到回答报文中 以匹配请求与回答
>
>   标志符，标志该报文形式，1比特的请求/回答报文（0回答 1请求）等标志
>
>   问题区域包含正在进行查询的查询信息
>
>   回答区域包含一条或多条RR
>
>   授权区域包含其他权威服务器的记录
>
>   附加区域包含其他帮助记录



#### P2P应用

#### TCP套接字编程

#### UDP套接字编程

























恍恍酒壶贫似洗,沥沥无语泪难停。

匆匆入世数十载,默默无奇述与君。

